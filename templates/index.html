<html>

<head>
<script>

    function makeBackendAPIRequest(url, callback) {
        let request = new XMLHttpRequest();
        request.open("GET", url)
        request.send();
        request.onload = () => {
            console.log(request);
            if (request.status === 200){
                parsedJSON = JSON.parse(request.response) 
                console.log(parsedJSON)
                emptyGameResultsTable()
                callback(parsedJSON)
            } else {
                console.log(`error ${request.status} ${request.statusText}`)
                return false
            }
        }
    }

    function getPlayerResults(playerId) {
        makeBackendAPIRequest("https://shrine-realpython-example-app.herokuapp.com/getPlayerResults?playerId=548", updateGameResultsTable)
    }

    function emptyGameResultsTable() {
        console.log('emptying game results table...')
        var table = document.getElementById('resultsTable');
        var rowCount = table.rows.length;
        console.log('rowCount: ' + rowCount)
        var rowIndex = 1;
        for (var i = rowIndex; i < rowCount; i++) {
            console.log('i: ' + i)
            console.log('rowIndex: ' + rowIndex)
            table.deleteRow(rowIndex);
        }
    }

    function updateGameResultsTable(tableData) {
        // is there a race condition for emptying the table, and maybe its trying to empty it at the same time its being populated?
        // figure out how to empty the game results table properly.
        console.log('inside updateGameResultsTable!')
        console.log('tableData: ' + tableData)
        console.log('tableData.length: ' + tableData.length)

        for (var i = 0; i < tableData.length; i++) {
            var obj = tableData[i];
            var newRow = document.getElementById('resultsTable').insertRow();
            for (var key in obj) {
                var value = obj[key];
                newRow.innerHTML += "<td>" + value + "</td>"
            }
            
        }
    }

    function getFirst50GameResults() {
        makeBackendAPIRequest("https://shrine-realpython-example-app.herokuapp.com/getPlayerResults?playerId=548", updateGameResultsTable)
    }
</script>
</head>

<body>

<a href="javascript:" onclick="getFirst50GameResults()">Show Global Leaderboards</a> |
<a href="javascript:" onclick="getPlayerResults(548)">Show Player 1 Results</a> |
<a href="javascript:" onclick="getPlayerResults(9887)">Show Player 2 Results</a>
    
<br/>
<br/>
<br/>

<table id="resultsTable" border="1" padding="5px">
    
  <tr>
      <th>GameId</th>
      <th>Player1Id</th>
      <th>Player2Id</th>
      <th>WinningPlayerId</th>
  </tr>



</table>

</body>

</html>